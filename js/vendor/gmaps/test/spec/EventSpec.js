describe("Creating event listeners",function(){var o,n,t,l,c,e,a,i,d,r,s,p,u,g,f;beforeEach(function(){o=o||new GMaps({el:"#events",lat:-12.0433,lng:-77.0283,zoom:12}),n=n||o.addMarker({lat:-12.0433,lng:-77.0283,title:"New marker"}),t=t||o.drawPolyline({path:[[-12.044,-77.0247],[-12.0544,-77.0302],[-12.0551,-77.0303],[-12.0759,-77.0276],[-12.0763,-77.0279],[-12.0768,-77.0289],[-12.0885,-77.0241],[-12.0908,-77.0227]],strokeColor:"#131540",strokeOpacity:.6,strokeWeight:6}),l=l||o.drawPolygon({paths:[[-12.0403,-77.0337],[-12.0402,-77.0399],[-12.05,-77.0244],[-12.0448,-77.0215]],strokeColor:"#25D359",strokeOpacity:1,strokeWeight:3,fillColor:"#25D359",fillOpacity:.6})}),describe("for google.maps events",function(){beforeEach(function(){c=c||{map:{onclick:function(){console.log("callbacks_native.map.onclick")}},marker:{onclick:function(){console.log("callbacks_native.marker.onclick")}},line:{onclick:function(){console.log("callbacks_native.line.onclick")}},polygon:{onclick:function(){console.log("callbacks_native.polygon.onclick")}}},spyOn(c.map,"onclick").andCallThrough(),spyOn(c.marker,"onclick").andCallThrough(),spyOn(c.line,"onclick").andCallThrough(),spyOn(c.polygon,"onclick").andCallThrough()}),describe("To a map",function(){it("should add the listener to the listeners collection",function(){var e=GMaps.on("click",o.map,c.map.onclick);expect(o.map.__e3_.click[e.id]).toBeDefined(),expect(o.map.__e3_.click[e.id]).toEqual(e)})}),describe("To a marker",function(){it("should add the listener to the listeners collection",function(){var e=GMaps.on("click",n,c.marker.onclick);expect(n.__e3_.click[e.id]).toBeDefined(),expect(n.__e3_.click[e.id]).toEqual(e)})}),describe("To a line",function(){it("should add the listener to the listeners collection",function(){var e=GMaps.on("click",t,c.line.onclick);expect(t.__e3_.click[e.id]).toBeDefined(),expect(t.__e3_.click[e.id]).toEqual(e)})}),describe("To a polygon",function(){it("should add the listener to the listeners collection",function(){var e=GMaps.on("click",l,c.polygon.onclick);expect(l.__e3_.click[e.id]).toBeDefined(),expect(l.__e3_.click[e.id]).toEqual(e)})}),describe("registering non custom events",function(){it("custom registered_events should not exist",function(){o.on("bounds_changed",function(){}),expect(o.registered_events.bounds_changed).not.toBeDefined()}),it("delegates the handler to google.map",function(){var e=!1;o.on("bounds_changed",function(){e=!0}),google.maps.event.trigger(o.map,"bounds_changed"),expect(e).toBe(!0)})}),describe("removing non custom events",function(){it("removes handler from google.map",function(){var e=!0;o.on("bounds_changed",function(){e=!1}),o.off("bounds_changed"),google.maps.event.trigger(o.map,"bounds_changed"),expect(e).toBe(!0)})})}),describe("for GMaps events",function(){beforeEach(function(){e={marker_added:function(){console.log("callbacks_gmaps.marker_added called")},marker_removed:function(){console.log("callbacks_gmaps.marker_removed called")},polyline_added:function(){console.log("callbacks_gmaps.polyline_added called")},polyline_removed:function(){console.log("callbacks_gmaps.polyline_removed called")},polygon_added:function(){console.log("callbacks_gmaps.polygon_added called")},polygon_removed:function(){console.log("callbacks_gmaps.polygon_removed called")}},spyOn(e,"marker_added").andCallThrough(),spyOn(e,"marker_removed").andCallThrough(),spyOn(e,"polyline_added").andCallThrough(),spyOn(e,"polyline_removed").andCallThrough(),spyOn(e,"polygon_added").andCallThrough(),spyOn(e,"polygon_removed").andCallThrough()}),describe("#marker_added",function(){beforeEach(function(){r=GMaps.on("marker_added",o,e.marker_added)}),it("should add the listener to the listeners collection",function(){expect(o.registered_events.marker_added[0]).toEqual(r)}),it("should trigger the listener created",function(){a=a||o.addMarker({lat:-12.0433,lng:-77.0273,title:"New marker"}),expect(e.marker_added).toHaveBeenCalled()}),afterEach(function(){GMaps.off("marker_added",o)})}),describe("#marker_removed",function(){beforeEach(function(){s=GMaps.on("marker_removed",o,e.marker_removed)}),it("should add the listener to the listeners collection",function(){expect(o.registered_events.marker_removed[0]).toEqual(s)}),it("should trigger the listener created",function(){o.removeMarker(a),expect(e.marker_removed).toHaveBeenCalled()}),afterEach(function(){GMaps.off("marker_removed",o)})}),describe("#polyline_added",function(){beforeEach(function(){p=GMaps.on("polyline_added",o,e.polyline_added)}),it("should add the listener to the listeners collection",function(){expect(o.registered_events.polyline_added[0]).toEqual(p)}),it("should trigger the listener created",function(){i=i||o.drawPolyline({path:[[-12.042,-77.0247],[-12.0544,-77.0102],[-12.0751,-77.0903],[-12.0759,-77.0276],[-12.0763,-77.0279],[-12.0768,-77.0289],[-12.0885,-77.0241],[-12.0908,-77.0227]],strokeColor:"#271804",strokeOpacity:.1,strokeWeight:1}),expect(e.polyline_added).toHaveBeenCalled()}),afterEach(function(){GMaps.off("polyline_added",o)})}),describe("#polyline_removed",function(){beforeEach(function(){u=GMaps.on("polyline_removed",o,e.polyline_removed)}),it("should add the listener to the listeners collection",function(){expect(o.registered_events.polyline_removed[0]).toEqual(u)}),it("should trigger the listener created",function(){o.removePolyline(i),expect(e.polyline_removed).toHaveBeenCalled()}),afterEach(function(){GMaps.off("polyline_removed",o)})}),describe("#polygon_added",function(){beforeEach(function(){g=GMaps.on("polygon_added",o,e.polygon_added)}),it("should add the listener to the listeners collection",function(){expect(o.registered_events.polygon_added[0]).toEqual(g)}),it("should trigger the listener created",function(){d=d||o.drawPolygon({paths:[[-12.0203,-77.0137],[-12.0402,-77.0109],[-12.05,-77.0144],[-12.0848,-77.0115]],strokeColor:"#D32559",strokeOpacity:.7,strokeWeight:8,fillColor:"#D32559",fillOpacity:.6}),expect(e.polygon_added).toHaveBeenCalled()}),afterEach(function(){GMaps.off("polygon_added",o)})}),describe("#polygon_removed",function(){beforeEach(function(){f=GMaps.on("polygon_removed",o,e.polygon_removed)}),it("should add the listener to the listeners collection",function(){expect(o.registered_events.polygon_removed[0]).toEqual(f)}),it("should trigger the listener created",function(){o.removePolygon(d),expect(e.polygon_removed).toHaveBeenCalled()}),afterEach(function(){GMaps.off("polygon_removed",o)})})})});